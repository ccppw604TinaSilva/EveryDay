# 初探富文本之在线文档交付
当我们实现在线文档的系统时，通常需要考虑到文档的导出能力，特别是对于私有化部署的复杂`ToB`产品来说，导出能力就显得非常重要，此外实际上成熟的在线文档系统还有很多复杂的场景，都需要我们提供文档导出的能力。那么本文就以`Quill`富文本编辑器引擎为基础，探讨文档导出为`MarkDown`、`Word`、`PDF`插件化设计实现。

## 描述
前段时间有位朋友跟我讲了个有趣的事，他们公司的某个`B`端大客户提了个需求，需要支持在他们的在线文档系统中直接支持远程连接打印机来打印文档，理由非常充分，就是他们公司的大老板不喜欢盯着电脑屏幕看文档，而是希望能够阅读纸质版的文档，为了不失去这家大客户就必须高优支持这个能力，当然这也确实是一个完整的在线文档`SaaS`系统所需要支持的能力。

虽然我们的在线文档主要是以`SaaS`提供服务的，但是同样我们也可以作为`PaaS`平台来提供服务，这样的场景也比较明确，例如我们的文档系统存储的数据结构通常都是自定义的数据结构，当用户想通过本地生成`MarkDown`模版的方式进行初始化文档内容时，我们就需要提供导入的能力，此时如果用户又想将文档转换为`MarkDown`模版，我们通常就又需要导出的能力，还有跨平台的数据迁移或者合作时，通常就需要我们通过`OpenAPI`提供各种各样数据转换的能力，而本质上还是基于我们的数据结构设计的一套转换系统。

回到数据转换能力本身，我们实际上可以以某种通用的数据结构类型为基准，在此基准上进行各种数据格式的转换，在我们的文档系统中，成本最小的通用数据结构就是`HTML`，我们可以以`HTML`为基准进行数据转换，并且有很多开源的实现可以参考。通过这种思路实现的数据转换是成本比较低的，但是效率上就没有那么高了，所以我们在这里聊的还是从我们的基准数据结构`DSL - Domain Specific Language`来进行数据转换，`quill-delta`的数据结构是设计的非常棒的扁平化富文本描述`DSL`，所以本文就以`quill-delta`的数据结构设计来聊聊数据转换导出。并且我们在设计转换模型的时候，需要考虑到插件化的设计，因为我们不能够保证文档系统后边不会扩展块类型，所以这个设计思想是非常有必要的，我们即将要聊的每个转换器设计都有相关示例`https://github.com/WindrunnerMax/QuillBlocks/tree/master/examples`。

## MarkDown
场景 团队

## Word

## PDF

## 每日一题

```
https://github.com/WindrunnerMax/EveryDay
```

## 参考

```
https://docx.js.org/
https://github.com/parallax/jsPDF
https://github.com/foliojs/pdfkit
https://github.com/Hopding/pdf-lib
https://quilljs.com/playground/snow
https://github.com/puppeteer/puppeteer
https://github.com/lillallol/outline-pdf
https://github.com/bpampuch/pdfmake/tree/0.2
```
